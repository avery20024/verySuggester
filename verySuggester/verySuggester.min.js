/*!
 * verySuggester version 0.1
 * plears check the link below for more information.
 * https://github.com/avery20024/verySuggester
 *
 * Copyright (c) 2016 Avery Wu
 * Released under the MIT license
 *
 * Last Modified: 2016-08-08
 */
(function(b){var a={init:function(c){return this.each(function(d){var e=b.extend({width:b(this).outerWidth(),distance:5,pivotType:"bottom",searchSymbol:"@",wrapClass:"suggest-wrap",listClass:"suggest-list",itemClass:"suggest-item",themeColor:"#26a4d8",searchList:["hotmail.com","gmail.com","yahoo.com.tw"]},c);b(this).data("verySuggester",a.checkSymbol(e));a.makeListAndSetLocation.call(this);b(this).keydown(function(f){if(f.which===40||f.which===38||f.which===13){f.preventDefault()}});b(this).keyup(a.handleKeyup);b(this).focus(function(){var f=b(this).siblings(".suggest-box");if(f.find("."+e.listClass).children().length>0){f.show()}});b(this).blur(function(){var f=setTimeout(function(){b(this).siblings(".suggest-box").fadeOut(150)}.bind(this),1000)})})},makeListAndSetLocation:function(){var c=b(this),h=c.data("verySuggester"),f,g,e={},d={};c.wrap('<div class="'+h.wrapClass+'"></div>').after('<div class="suggest-box"><div class="suggest-arrow"></div><div class="'+h.listClass+'"></div></div>');f=c.siblings(".suggest-box");g=f.find(".suggest-arrow");if(h.pivotType==="bottom"){e={top:parseInt(c.css("margin-top"))+c.outerHeight()+h.distance,bottom:"auto",left:parseInt(c.css("margin-left"))}}else{e={top:"auto",bottom:parseInt(c.css("margin-bottom"))+c.outerHeight()+h.distance,left:parseInt(c.css("margin-left"))}}f.css(e).find("."+h.listClass).css({width:parseInt(h.width),"border-color":h.themeColor}).data("item",h.searchList).parent("."+h.wrapClass).addClass(h.pivotType+"-box");if(h.pivotType==="bottom"){d={"border-bottom-color":c.data("verySuggester").themeColor}}else{d={"border-top-color":c.data("verySuggester").themeColor}}g.css(d)},checkSymbol:function(e){var d=e.searchList,c=0;for(c;c<d.length;c++){if(d[c].slice(0,1)!==e.searchSymbol){d[c]=e.searchSymbol+d[c]}}return e},handleKeyup:function(e){var f=b(this),l=f.data("verySuggester"),g=f.val(),j=f.siblings(".suggest-box"),c=[];if(f.val().indexOf(l.searchSymbol)===-1||f.val().slice(0,b(this).val().indexOf(l.searchSymbol))===""){j.hide().find("."+l.listClass).html("");return}if(e.which===38||e.which===40){a.moveThroughItem.call(this,e.which,j.find("."+l.listClass));return}else{if(e.which===13){if(j.find("."+l.listClass).find(".cur").length===0){return}a.selectItem(j.find(".cur"),f);return}}var o=g.slice(g.indexOf(l.searchSymbol));var d=g.slice(0,g.indexOf(l.searchSymbol));for(var h=0;h<l.searchList.length;h++){if(l.searchList[h].indexOf(o)!==-1){c.push('<div class="'+l.itemClass+'" data-idx="'+c.length+'"><span class="suggest-retain">'+d+'</span><span class="suggest-domain">'+l.searchList[h]+"</span></div>")}}if(c.length>0){var k=j.find("."+l.listClass),n=j.find(".suggest-arrow"),m=0;k.html(c.join("")).find(".suggest-domain").each(function(i,p){if(b(p).width()>m){m=b(p).width()}}).siblings(".suggest-retain").css("max-width","calc(100% - "+(m+2)+"px)");k.children().hover(function(){b(this).css({"background-color":f.data("verySuggester").themeColor})},function(){b(this).css({"background-color":"initial",color:"initial"})});j.find("."+l.itemClass).click(function(){a.selectItem(b(this),f)});j.show()}else{j.hide().find("."+l.listClass).html("")}},moveThroughItem:function(c,f){var g=b(this).data("verySuggester"),d=f.children(".cur").data("idx"),e=0;if(c===40){e=(d||d==0)?d+1:0}else{if(c===38){e=(d)?d-1:f.children().length-1}}switch(c){case 40:e=(d||d==0)?d+1:0;break;case 38:e=(d)?d-1:f.children().length-1;break;default:break}f.children().css({"background-color":"initial"}).removeClass("cur").eq(e).css({"background-color":g.themeColor}).addClass("cur")},selectItem:function(c,e){var d=e.data("verySuggester");e.val(c.text());e.siblings(".suggest-box").find("."+d.listClass).html("").end().hide()}};b.fn.verySuggester=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(!c||typeof c==="object"){return a.init.call(this,c)}else{b.error("Method "+c+" does not exist on jQuery.tooltip")}}}})(jQuery);

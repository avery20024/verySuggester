/*!
 * verySuggester version 0.1
 * plears check the link below for more information.
 * https://github.com/avery20024/verySuggester
 *
 * Copyright (c) 2016 Avery Wu
 * Released under the MIT license
 *
 * Last Modified: 2016-08-19
 */
(function(b){var a={init:function(c){return this.each(function(d){var e=b.extend({width:b(this).outerWidth(),distance:5,additionalClass:"",pivotType:"bottom",searchSymbol:"@",fontColor:"#FFF",themeColor:"#6D6D6D",limitItem:0,searchList:["hotmail.com","gmail.com","yahoo.com.tw"]},c);b(this).data("verySuggester",a.checkSymbol(e));a.makeListAndSetLocation.call(this);b(this).keydown(function(f){if(f.which===40||f.which===38||f.which===13){f.preventDefault()}});b(this).keyup(a.handleKeyup);b(this).focus(function(){var f=b(this).siblings(".suggest-box");if(f.find(".suggest-list").children().length>0){f.show()}});b(this).blur(function(){b(this).siblings(".suggest-box").delay().stop().fadeOut(150)})})},makeListAndSetLocation:function(){var c=b(this),h=c.data("verySuggester"),f,e={},g={},d={};c.wrap('<div class="suggest-wrap"></div>').after('<div class="suggest-box"><div class="suggest-arrow"></div><div class="suggest-list"></div></div>');f=c.siblings(".suggest-box");if(h.additionalClass!==""){f.addClass(h.additionalClass)}if(h.pivotType.toLowerCase()==="bottom"){e={top:parseInt(c.css("margin-top"))+c.outerHeight()+h.distance,};g={top:"10px",};d={top:h.distance*-2,"border-bottom-color":h.themeColor}}else{if(h.pivotType.toLowerCase()==="top"){e={top:parseInt(c.css("margin-top"))-h.distance};g={top:"auto",bottom:"10px"};d={top:"auto",bottom:"-10px","border-top-color":h.themeColor}}}e.left=parseInt(c.css("margin-left"));f.css(e).find(".suggest-list").css(g).css({width:parseInt(h.width),"border-color":h.themeColor}).end().find(".suggest-arrow").css(d)},checkSymbol:function(e){var d=e.searchList,c=0;for(c;c<d.length;c++){if(d[c].slice(0,1)!==e.searchSymbol){d[c]=e.searchSymbol+d[c]}}return e},handleKeyup:function(e){var f=b(this),l=f.data("verySuggester"),g=f.val(),j=f.siblings(".suggest-box"),c=[];if(f.val().indexOf(l.searchSymbol)===-1||f.val().slice(0,b(this).val().indexOf(l.searchSymbol))===""){j.hide().find(".suggest-list").html("");return}if(e.which===38||e.which===40){a.moveThroughItem.call(this,e.which,j.find(".suggest-list"));return}else{if(e.which===13){if(j.find(".suggest-list").find(".cur").length===0){return}a.selectItem(j.find(".cur"),f);return}}var o=g.slice(g.indexOf(l.searchSymbol));var d=g.slice(0,g.indexOf(l.searchSymbol));for(var h=0;h<l.searchList.length;h++){if(l.searchList[h].indexOf(o)!==-1){c.push('<div class="suggest-item" data-idx="'+c.length+'"><span class="suggest-retain">'+d+'</span><span class="suggest-domain">'+l.searchList[h]+"</span></div>")}}if(c.length>0){var k=j.find(".suggest-list"),n=j.find(".suggest-arrow"),m=0;k.html(c.join("")).find(".suggest-domain").each(function(i,p){if(b(p).width()>m){m=b(p).width()}}).siblings(".suggest-retain").css("max-width","calc(100% - "+(m+2)+"px)");k.children().hover(function(){b(this).addClass("cur").siblings().removeClass("cur");a.updateChosenStyle(k,l)},function(){b(this).siblings().add(b(this)).removeClass("cur");a.updateChosenStyle(k,l)});j.find(".suggest-item").click(function(){a.selectItem(b(this),f)}).end().show();if(l.limitItem!==0){k.css({"max-height":(k.children().outerHeight()*l.limitItem)+3,"overflow-y":"auto"})}}else{j.hide().find(".suggest-list").html("")}},moveThroughItem:function(c,f){var g=b(this).data("verySuggester"),d=f.children(".cur").data("idx"),e=0;if(c===40){e=(d||d==0)?d+1:0}else{if(c===38){e=(d)?d-1:f.children().length-1}}switch(c){case 40:e=(d||d==0)?d+1:0;break;case 38:e=(d)?d-1:f.children().length-1;break;default:break}f.children().removeClass("cur").eq(e).addClass("cur");a.updateChosenStyle(f,g)},selectItem:function(c,e){var d=e.data("verySuggester");e.val(c.text());e.siblings(".suggest-box").find(".suggest-list").html("").end().hide()},updateChosenStyle:function(c,d){c.children().prop("style","").filter(".cur").css({background:d.themeColor,color:d.fontColor})}};b.fn.verySuggester=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(!c||typeof c==="object"){return a.init.call(this,c)}else{b.error("Method "+c+" does not exist on jQuery.tooltip")}}}})(jQuery);

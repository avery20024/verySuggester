/*!
 * verySuggester version 0.1
 * plears check the link below for more information.
 * https://github.com/avery20024/verySuggester
 *
 * Copyright (c) 2016 Avery Wu
 * Released under the MIT license
 *
 * Last Modified: 2016-08-24
 */
(function(b){var a={init:function(c){if(b(this).data("verySuggester")){return false}var d=b.extend({width:b(this).outerWidth(),distance:5,additionalClass:"",pivotType:"bottom",searchSymbol:"@",fontColor:"#FFF",themeColor:"#6D6D6D",limitItem:0,searchList:["hotmail.com","gmail.com","yahoo.com.tw"]},c);b(this).data("verySuggester",a.checkSymbol(d));a.makeListAndSetLocation.call(this);b(this).on("focus keyup",a.handleKeyup).on("keydown",function(f){if(f.which===40||f.which===38||f.which===13){f.preventDefault()}}).on("blur",function(){b(this).siblings(".suggest-box").delay().stop().fadeOut(150)})},makeListAndSetLocation:function(){var c=b(this),h=c.data("verySuggester"),f,e={},g={},d={};c.wrap('<div class="suggest-wrap"></div>').after('<div class="suggest-box"><div class="suggest-arrow"></div><div class="suggest-list"></div></div>');f=c.siblings(".suggest-box");if(h.additionalClass!==""){f.addClass(h.additionalClass)}if(h.pivotType.toLowerCase()==="bottom"){e={top:parseInt(c.css("margin-top"))+c.outerHeight()+h.distance,};g={top:"10px",};d={top:h.distance*-2,"border-bottom-color":h.themeColor}}else{if(h.pivotType.toLowerCase()==="top"){e={top:parseInt(c.css("margin-top"))-h.distance};g={top:"auto",bottom:"10px"};d={top:"auto",bottom:"-10px","border-top-color":h.themeColor}}}e.left=parseInt(c.css("margin-left"));f.css(e).find(".suggest-list").css(g).css({width:parseInt(h.width),"border-color":h.themeColor}).end().find(".suggest-arrow").css(d)},checkSymbol:function(e){var d=e.searchList,c=0;for(c;c<d.length;c++){if(d[c].slice(0,1)!==e.searchSymbol){d[c]=e.searchSymbol+d[c]}}return e},handleKeyup:function(d){var f=b(this),k=f.data("verySuggester"),g=f.val(),j=f.siblings(".suggest-box"),n=j.find(".suggest-arrow"),l=j.find(".suggest-list"),c=[];if(d.which===38||d.which===40){a.moveThroughItem.call(this,d.which,j.find(".suggest-list"));return}else{if(d.which===13){if(j.find(".suggest-list").find(".cur").length===0){return}a.selectItem(j.find(".cur"),f);return}}if(f.val().indexOf(k.searchSymbol)===-1||f.val().slice(0,b(this).val().indexOf(k.searchSymbol))===""){j.hide().find(".suggest-list").html("");return}var e=g.slice(g.indexOf(k.searchSymbol));var o=g.slice(0,g.indexOf(k.searchSymbol));for(var h=0;h<k.searchList.length;h++){if(k.searchList[h].indexOf(e)!==-1){c.push('<div class="suggest-item" data-idx="'+c.length+'"><span class="suggest-retain">'+o+'</span><span class="suggest-domain">'+k.searchList[h]+"</span></div>")}}if(c.length>0){var m=0;l.html(c.join("")).promise().done(function(){l.children().hover(function(){b(this).addClass("cur").siblings().removeClass("cur");a.updateChosenStyle(l,k)},function(){l.children().removeClass("cur");a.updateChosenStyle(l,k)}).click(function(){a.selectItem(b(this),f)});j.show().find(".suggest-domain").each(function(i,p){if(b(p).outerWidth()>m){m=b(p).outerWidth()}}).end().find(".suggest-retain").css("max-width",l.find(".suggest-item").width()-m-10);if(k.limitItem!==0&&c.length>k.limitItem){l.css({"max-height":(l.children().outerHeight()*k.limitItem)+3,"overflow-y":"auto"})}})}else{j.hide().find(".suggest-list").html("");l.css("max-height","auto").html("");if(k.limitItem!==0){l.scrollTop(0)}}},moveThroughItem:function(c,f){var g=b(this).data("verySuggester"),e=f.children(".cur").data("idx"),d=0;switch(c){case 40:d=(e||e==0)?e+1:0;if(e===f.children().length-1){d=0}break;case 38:d=(e)?e-1:f.children().length-1;break;default:break}f.children().removeClass("cur").eq(d).addClass("cur");a.updateChosenStyle(f,g)},selectItem:function(c,e){var d=e.data("verySuggester");e.val(c.text());e.siblings(".suggest-box").find(".suggest-list").html("").end().hide()},updateChosenStyle:function(d,e){var c=d.find(".cur");d.children().prop("style","");c.css({background:e.themeColor,color:e.fontColor});if(e.limitItem!==0){var f=c.index()*d.children().outerHeight();if(c.index()===0){f=0}d.scrollTop(f)}}};b.fn.verySuggester=function(c){return this.each(function(){if(a[c]){a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(!c||typeof c==="object"){a.init.call(this,c)}else{b.error("Method "+c+" does not exist on jQuery.tooltip")}}})}})(jQuery);
